# 다음 개발 계획

## 🔍 프로젝트 필수 체크리스트

### 이미 완료된 것 ✅
| 항목 | 상태 | 설명 |
|------|------|------|
| 인증/인가 | ✅ | JWT + OAuth2 |
| 공통 API 응답 | ✅ | `ApiResponse<T>` |
| 공통 에러 처리 | ✅ | `GlobalExceptionHandler` |
| 유효성 검증 | ✅ | `@Valid` + DTO |
| 통합 테스트 | ✅ | 58개 테스트 |
| Swagger | ✅ | `http://localhost:8080/swagger-ui.html` |
| Actuator | ✅ | `http://localhost:8080/actuator/health` |
| Logback 로깅 | ✅ | `logs/application.log`, `logs/error.log` |

### 해야 할 것 📋
| 항목 | 우선순위 | 설명 |
|------|----------|------|
| **CORS 설정** | ⭐ | 앱/다른 도메인에서 API 호출 시 필요 |
| **application-prod.yml** | ⭐⭐ | 운영 환경 설정 분리 |
| **배포** | ⭐⭐⭐ | Docker + AWS/Railway |

---

## 🔀 의존성 분석

### 독립적으로 진행 가능 ✅
| 항목 | 설명 |
|------|------|
| **CORS 설정** | 앱에서 API 호출 시 필요. 15분 |

### 연계해서 생각해야 함 🔗
| 항목 | 연관 관계 |
|------|----------|
| **배포** | Redis, 캐싱, DB 분리, HTTPS 모두 배포 환경에 영향 |
| **Redis** | 배포 시 Redis 서버 필요, 캐싱과 함께 사용 |
| **캐싱** | Redis를 캐시 저장소로 사용하는 것이 일반적 |
| **HTTPS** | 배포 시 적용 (Let's Encrypt) |

---

## 🗓️ 권장 진행 순서

### Phase 1.5: 남은 독립 작업 📋
| 순서 | 항목 | 소요시간 | 설명 |
|------|------|----------|------|
| 1 | **CORS 설정** | 15분 | 앱에서 API 호출 시 필요 |

### Phase 2: 배포 + 인프라 👈 다음 단계
| 순서 | 항목 | 소요시간 | 설명 |
|------|------|----------|------|
| 2 | **application-prod.yml** | 30분 | 운영 환경 설정 분리 |
| 3 | **Dockerfile 작성** | 1시간 | 배포 준비 |
| 4 | **Docker Compose** | 1시간 | App + DB + (Redis) |
| 5 | **AWS/클라우드 배포** | 2~4시간 | EC2 또는 Railway |
| 6 | **HTTPS + 도메인** | 1~2시간 | Let's Encrypt |

### Phase 3: 성능 최적화 (선택)
| 순서 | 항목 | 소요시간 | 설명 |
|------|------|----------|------|
| 7 | **Redis 적용** | 2시간 | Refresh Token → Redis |
| 8 | **캐싱 적용** | 2시간 | 자주 조회 데이터 캐싱 |

---

## 📋 배포 상세

**Docker Compose 예시:**
```yaml
version: '3.8'
services:
  app:
    build: .
    ports:
      - "8080:8080"
    depends_on:
      - db
    environment:
      - SPRING_PROFILES_ACTIVE=prod

  db:
    image: mariadb:10.11
    environment:
      - MYSQL_ROOT_PASSWORD=root
      - MYSQL_DATABASE=doll_gacha
    volumes:
      - db_data:/var/lib/mysql

volumes:
  db_data:
```

**배포 옵션:**
| 옵션 | 비용 | 난이도 |
|------|------|--------|
| AWS EC2 + Docker Compose | 무료~유료 | ⭐⭐ |
| Railway | 무료~유료 | ⭐ 쉬움 |

---

## 📱 앱 개발 관련

서버 `RefreshController`가 웹/앱 모두 지원하도록 구현됨:

| 구분 | 웹 (브라우저) | 앱 (Flutter 등) |
|------|-------------|-----------------|
| 토큰 저장 | HttpOnly 쿠키 | SecureStorage |
| 재발급 요청 | 쿠키 자동 전송 | Authorization 헤더 |
| 새 토큰 응답 | Set-Cookie | JSON |

