# 다음 개발 계획

## ✅ 완료된 기능들

| 기능 | 상태 | 설명 |
|------|------|------|
| JWT 인증 | ✅ 완료 | 로그인/로그아웃/회원가입 |
| OAuth2 소셜 로그인 | ✅ 완료 | 카카오/구글 |
| Access Token 자동 재발급 | ✅ 완료 | 웹(쿠키)/앱(헤더) 모두 지원 |
| 공통 API 응답 처리 | ✅ 완료 | `ApiResponse<T>` 형식 |
| 공통 에러 처리 | ✅ 완료 | `GlobalExceptionHandler`, `ErrorResponse` |
| 커뮤니티 CRUD | ✅ 완료 | 게시글 작성/수정/삭제/조회 |
| 댓글 CRUD | ✅ 완료 | 댓글 작성/수정/삭제 |
| 리뷰 CRUD | ✅ 완료 | 리뷰 작성/삭제/조회 |
| 파일 업로드 | ✅ 완료 | 이미지/첨부파일 업로드 |
| 매장 조회 | ✅ 완료 | 지도/목록/상세 |
| 통합 테스트 | ✅ 완료 | 58개 테스트 (100% 통과) |
| 헤더 동적 로그인 상태 | ✅ 완료 | JavaScript로 로그인 상태 업데이트 |

---

## 🔀 의존성 분석

### 독립적으로 진행 가능 ✅
| 항목 | 설명 |
|------|------|
| **Swagger** | 코드 추가만 하면 됨. 다른 것과 무관 |
| **로깅/모니터링** | 코드 추가만 하면 됨. 다른 것과 무관 |
| **테스트 보강** | 기존 코드에 테스트만 추가 |

### 연계해서 생각해야 함 🔗
| 항목 | 연관 관계 |
|------|----------|
| **배포** | Redis, 캐싱, DB 분리 모두 배포 환경에 영향 |
| **Redis** | 배포 시 Redis 서버 필요, 캐싱과 함께 사용 |
| **캐싱** | Redis를 캐시 저장소로 사용하는 것이 일반적 |
| **DB 분리** | 배포 시 RDS 또는 외부 DB 필요 |

```
[독립]                    [연계]
Swagger ─────┐
             │
로깅/모니터링 ─┼──> 언제든 적용 가능
             │
테스트 보강 ──┘

                         ┌─ Redis ←──┐
배포 ──────────────────>├─ 캐싱 ←───┤ 함께 고려
                         ├─ DB 분리   │
                         └─ HTTPS ────┘
```

---

## 🗓️ 권장 진행 순서

### Phase 1: 독립 작업 (바로 가능)
| 순서 | 항목 | 소요시간 | 설명 |
|------|------|----------|------|
| 1 | **Swagger** | 30분 | API 문서 자동 생성. 가장 쉽고 유용함 |
| 2 | **로깅 설정** | 1시간 | Logback 파일 로깅. 운영 시 필수 |
| 3 | **테스트 보강** | 필요시 | 추가 테스트 케이스 작성 |

### Phase 2: 배포 + 인프라 (연계 작업)
| 순서 | 항목 | 소요시간 | 설명 |
|------|------|----------|------|
| 4 | **Dockerfile 작성** | 1시간 | 배포 준비 |
| 5 | **application-prod.yml** | 30분 | 운영 환경 설정 분리 |
| 6 | **Docker Compose** | 1시간 | App + DB + Redis 한번에 구성 |
| 7 | **AWS/클라우드 배포** | 2~4시간 | EC2 또는 Railway |
| 8 | **HTTPS + 도메인** | 1~2시간 | Let's Encrypt, 도메인 연결 |

### Phase 3: 성능 최적화 (선택)
| 순서 | 항목 | 소요시간 | 설명 |
|------|------|----------|------|
| 9 | **Redis 적용** | 2시간 | Refresh Token → Redis 이관 |
| 10 | **캐싱 적용** | 2시간 | 매장 목록 등 자주 조회 데이터 캐싱 |

---

## 📋 상세 내용

### 1️⃣ Swagger (API 문서화) - 독립 ✅
**난이도**: 쉬움 (30분)

**적용 후:**
- `http://localhost:8080/swagger-ui.html` 에서 모든 API 확인 가능

**적용 방법:**
```gradle
// build.gradle에 추가
implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.3.0'
```

---

### 2️⃣ 로깅/모니터링 - 독립 ✅
**난이도**: 쉬움 (1시간)

**도구 옵션:**
- **Logback**: Spring 기본 로깅 (파일 저장)
- **Actuator**: Spring Boot 상태 모니터링
- **Sentry**: 에러 추적 서비스 (선택)

---

### 3️⃣ 배포 + Redis + 캐싱 - 연계 🔗
**난이도**: 보통 (1~2일)

**Docker Compose로 한번에 구성:**
```yaml
version: '3.8'
services:
  app:
    build: .
    ports:
      - "8080:8080"
    depends_on:
      - db
      - redis
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - SPRING_REDIS_HOST=redis
      - SPRING_DATASOURCE_URL=jdbc:mariadb://db:3306/doll_gacha

  db:
    image: mariadb:10.11
    environment:
      - MYSQL_ROOT_PASSWORD=root
      - MYSQL_DATABASE=doll_gacha
    volumes:
      - db_data:/var/lib/mysql

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

volumes:
  db_data:
```

**배포 옵션:**
| 옵션 | 비용 | 난이도 | Redis 포함 |
|------|------|--------|-----------|
| AWS EC2 + Docker Compose | 무료~유료 | ⭐⭐ | ✅ 직접 구성 |
| AWS ECS + ElastiCache | 유료 | ⭐⭐⭐ | ✅ 관리형 |
| Railway | 무료~유료 | ⭐ | ✅ 쉬움 |

---

## 📱 앱 개발 관련

현재 웹에서 구현된 토큰 재발급 로직은 앱에서도 동일하게 적용 가능:

| 구분 | 웹 (브라우저) | 앱 (Flutter 등) |
|------|-------------|-----------------|
| 토큰 저장 | HttpOnly 쿠키 (자동) | SecureStorage (수동) |
| 재발급 요청 | 쿠키 자동 전송 | `Authorization: Bearer {refresh_token}` 헤더 |
| 새 토큰 응답 | Set-Cookie로 자동 저장 | JSON으로 받아서 직접 저장 |

서버 `RefreshController`가 이미 둘 다 지원하도록 구현됨.

---

## 📝 메모

- 현재 access_token 만료시간: 30초 (테스트용)
- **운영 시 변경 필요**: `application.yml`에서 `expiration_access: 1800000` (30분)

---

## 🔧 Git 에러 해결 (참고)

현재 발생한 Git 에러:
```
error: could not delete references: cannot lock ref 'refs/remotes/remote/HEAD'
```

**해결 방법:**
```bash
# 1. 깨진 참조 정리
git gc --prune=now

# 2. remote 재설정
git remote remove origin
git remote add origin https://github.com/gks930620/doll_gacha.git

# 3. 다시 fetch
git fetch origin
```

