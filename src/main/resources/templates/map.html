<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïù∏ÌòïÎΩëÍ∏∞Î∞© Ï†ïÎ≥¥ - ÏßÄÎèÑ</title>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: #fafafa;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header Styles */
        .app-header {
            background-color: #6200ea;
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 64px;
        }

        .header-logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 20px;
            font-weight: 500;
            text-decoration: none;
            color: white;
            cursor: pointer;
        }

        .header-logo .material-icons {
            font-size: 28px;
        }

        .header-nav {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .nav-item {
            padding: 8px 16px;
            border-radius: 4px;
            text-decoration: none;
            color: white;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: background-color 0.2s;
            font-size: 14px;
            font-weight: 500;
        }

        .nav-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .nav-item.active {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .nav-item .material-icons {
            font-size: 20px;
        }

        /* Mobile Menu */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 8px;
        }

        .mobile-menu-btn .material-icons {
            font-size: 24px;
        }

        @media (max-width: 768px) {
            .header-nav {
                display: none;
                position: absolute;
                top: 64px;
                left: 0;
                right: 0;
                background-color: #6200ea;
                flex-direction: column;
                padding: 8px;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            }

            .header-nav.mobile-open {
                display: flex;
            }

            .nav-item {
                width: 100%;
                justify-content: flex-start;
            }

            .mobile-menu-btn {
                display: block;
            }
        }

        /* Main Content */
        .main-content {
            flex: 1;
            width: 100%;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
        }

        /* Footer Styles */
        .app-footer {
            background-color: #424242;
            color: #e0e0e0;
            border-top: 1px solid #616161;
            height: 80px;
            display: flex;
            align-items: center;
        }

        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
            width: 100%;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
        }

        .footer-company {
            color: #e0e0e0;
        }

        .footer-company strong {
            color: white;
            margin-right: 8px;
        }

        .footer-links {
            display: flex;
            gap: 16px;
        }

        .footer-links a {
            color: #e0e0e0;
            text-decoration: none;
            font-size: 13px;
            transition: color 0.2s;
        }

        .footer-links a:hover {
            color: #bb86fc;
        }

        @media (max-width: 768px) {
            .app-footer {
                height: auto;
                padding: 20px 0;
            }

            .footer-content {
                flex-direction: column;
                gap: 12px;
                text-align: center;
            }
        }

        /* Region Filter Section */
        .region-filter-section {
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .filter-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-group label {
            font-size: 14px;
            font-weight: 500;
            color: #424242;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .filter-select {
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 8px 12px;
            font-size: 14px;
            outline: none;
            cursor: pointer;
            background: white;
            min-width: 150px;
            transition: border-color 0.2s;
        }

        .filter-select:hover {
            border-color: #6200ea;
        }

        .filter-select:focus {
            border-color: #6200ea;
            box-shadow: 0 0 0 2px rgba(98, 0, 234, 0.1);
        }

        .shop-count-badge {
            background: #6200ea;
            color: white;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 500;
            margin-left: auto;
        }

        /* Map specific styles */
        .map-wrapper {
            width: 100%;
            padding: 24px;
            background-color: #fafafa;
        }

        .map-container {
            max-width: 1200px;
            margin: 0 auto;
            height: 600px; /* Í≥†Ï†ï ÎÜíÏù¥ */
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        #map {
            width: 100%;
            height: 100%;
            background-color: #f0f0f0;
        }

        .map-controls {
            position: absolute;
            top: 16px;
            left: 16px;
            right: 16px;
            z-index: 100;
            display: none; /* ÌïÑÌÑ∞Í∞Ä ÏúÑÎ°ú Ïù¥ÎèôÌñàÏúºÎØÄÎ°ú Ïà®ÍπÄ */
            gap: 12px;
            flex-wrap: wrap;
        }

        .search-box {
            background: white;
            border-radius: 8px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            flex: 1;
            min-width: 300px;
        }

        .search-box input {
            border: none;
            outline: none;
            font-size: 14px;
            flex: 1;
            padding: 0;
        }

        .search-box .material-icons {
            color: #757575;
            font-size: 20px;
        }

        .search-box button {
            background: none;
            border: none;
            padding: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            color: #6200ea;
        }

        .search-box button:hover {
            color: #3700b3;
        }

        .filter-btn {
            background: white;
            border: none;
            border-radius: 8px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #424242;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            background-color: #f5f5f5;
        }

        .filter-btn .material-icons {
            font-size: 20px;
        }

        .map-info {
            margin-top: 24px;
            background: white;
            border-radius: 8px;
            padding: 24px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .map-info h3 {
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 16px;
            color: #212121;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }

        .info-card {
            padding: 16px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .info-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .info-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .info-card-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #e1bee7;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6200ea;
        }

        .info-card-icon .material-icons {
            font-size: 24px;
        }

        .info-card h4 {
            font-size: 16px;
            font-weight: 500;
            color: #212121;
        }

        .info-card p {
            font-size: 14px;
            color: #757575;
            line-height: 1.5;
        }

        /* Custom Marker Info Window */
        .custom-infowindow {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            padding: 16px;
            min-width: 250px;
        }

        .infowindow-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .infowindow-title {
            font-size: 16px;
            font-weight: 500;
            color: #212121;
            margin-bottom: 4px;
        }

        .infowindow-rating {
            color: #f57c00;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .infowindow-body {
            font-size: 14px;
            color: #757575;
            line-height: 1.6;
        }

        .infowindow-body p {
            margin: 4px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .infowindow-body .material-icons {
            font-size: 18px;
            color: #9e9e9e;
        }

        .infowindow-close {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            color: #757575;
            display: flex;
            align-items: center;
        }

        .infowindow-close:hover {
            color: #212121;
        }

        .infowindow-close .material-icons {
            font-size: 20px;
        }

        .infowindow-footer {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 8px;
        }

        .infowindow-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            transition: all 0.2s;
        }

        .infowindow-btn-primary {
            background-color: #6200ea;
            color: white;
        }

        .infowindow-btn-primary:hover {
            background-color: #3700b3;
        }

        .infowindow-btn-secondary {
            background-color: #f5f5f5;
            color: #424242;
        }

        .infowindow-btn-secondary:hover {
            background-color: #eeeeee;
        }

        .infowindow-btn .material-icons {
            font-size: 16px;
        }

        /* Loading Indicator */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            display: none;
            z-index: 1000;
        }

        .loading.active {
            display: block;
        }

        @media (max-width: 768px) {
            .filter-container {
                padding: 12px 16px;
            }

            .filter-group {
                flex: 1 1 auto;
            }

            .filter-select {
                min-width: auto;
                flex: 1;
            }

            .shop-count-badge {
                width: 100%;
                text-align: center;
                margin-left: 0;
            }

            .map-wrapper {
                padding: 16px;
            }

            .map-container {
                height: 500px;
                border-radius: 4px;
            }
        }
    </style>
</head>
<body>
    <header class="app-header">
        <div class="header-container">
            <a href="/" class="header-logo">
                <span class="material-icons">toys</span>
                <span>Ïù∏ÌòïÎΩëÍ∏∞Î∞©</span>
            </a>

            <nav class="header-nav" id="headerNav">
                <a href="/map" class="nav-item active">
                    <span class="material-icons">map</span>
                    <span>ÏßÄÎèÑ</span>
                </a>
                <a href="/community" class="nav-item">
                    <span class="material-icons">forum</span>
                    <span>Ïª§ÎÆ§ÎãàÌã∞</span>
                </a>
                <a href="/doll" class="nav-item">
                    <span class="material-icons">smart_toy</span>
                    <span>Ïù∏ÌòïÏ†ïÎ≥¥</span>
                </a>
            </nav>

            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <span class="material-icons">menu</span>
            </button>
        </div>
    </header>

    <main class="main-content">
        <!-- ÏßÄÏó≠ ÌïÑÌÑ∞ ÏÑπÏÖò -->
        <div class="region-filter-section">
            <div class="filter-container">
                <div class="filter-group">
                    <label for="sidoSelect">
                        <span class="material-icons" style="font-size: 18px;">location_city</span>
                        Ïãú/ÎèÑ
                    </label>
                    <select id="sidoSelect" class="filter-select" onchange="onSidoChange()">
                        <option value="ÏÑúÏö∏ÌäπÎ≥ÑÏãú">ÏÑúÏö∏ÌäπÎ≥ÑÏãú</option>
                        <option value="Î∂ÄÏÇ∞Í¥ëÏó≠Ïãú">Î∂ÄÏÇ∞Í¥ëÏó≠Ïãú</option>
                        <option value="ÎåÄÍµ¨Í¥ëÏó≠Ïãú">ÎåÄÍµ¨Í¥ëÏó≠Ïãú</option>
                        <option value="Ïù∏Ï≤úÍ¥ëÏó≠Ïãú">Ïù∏Ï≤úÍ¥ëÏó≠Ïãú</option>
                        <option value="Í¥ëÏ£ºÍ¥ëÏó≠Ïãú">Í¥ëÏ£ºÍ¥ëÏó≠Ïãú</option>
                        <option value="ÎåÄÏ†ÑÍ¥ëÏó≠Ïãú">ÎåÄÏ†ÑÍ¥ëÏó≠Ïãú</option>
                        <option value="Ïö∏ÏÇ∞Í¥ëÏó≠Ïãú">Ïö∏ÏÇ∞Í¥ëÏó≠Ïãú</option>
                        <option value="ÏÑ∏Ï¢ÖÌäπÎ≥ÑÏûêÏπòÏãú">ÏÑ∏Ï¢ÖÌäπÎ≥ÑÏûêÏπòÏãú</option>
                        <option value="Í≤ΩÍ∏∞ÎèÑ">Í≤ΩÍ∏∞ÎèÑ</option>
                        <option value="Í∞ïÏõêÌäπÎ≥ÑÏûêÏπòÎèÑ">Í∞ïÏõêÌäπÎ≥ÑÏûêÏπòÎèÑ</option>
                        <option value="Ï∂©Ï≤≠Î∂ÅÎèÑ">Ï∂©Ï≤≠Î∂ÅÎèÑ</option>
                        <option value="Ï∂©Ï≤≠ÎÇ®ÎèÑ">Ï∂©Ï≤≠ÎÇ®ÎèÑ</option>
                        <option value="Ï†ÑÎ∂ÅÌäπÎ≥ÑÏûêÏπòÎèÑ">Ï†ÑÎ∂ÅÌäπÎ≥ÑÏûêÏπòÎèÑ</option>
                        <option value="Ï†ÑÎùºÎÇ®ÎèÑ">Ï†ÑÎùºÎÇ®ÎèÑ</option>
                        <option value="Í≤ΩÏÉÅÎ∂ÅÎèÑ">Í≤ΩÏÉÅÎ∂ÅÎèÑ</option>
                        <option value="Í≤ΩÏÉÅÎÇ®ÎèÑ">Í≤ΩÏÉÅÎÇ®ÎèÑ</option>
                        <option value="Ï†úÏ£ºÌäπÎ≥ÑÏûêÏπòÎèÑ">Ï†úÏ£ºÌäπÎ≥ÑÏûêÏπòÎèÑ</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="sigunguSelect">
                        <span class="material-icons" style="font-size: 18px;">place</span>
                        Ïãú/Íµ∞/Íµ¨
                    </label>
                    <select id="sigunguSelect" class="filter-select" onchange="onSigunguChange()">
                        <option value="">Ï†ÑÏ≤¥</option>
                    </select>
                </div>

                <div class="shop-count-badge" id="shopCount">
                    ÏßÄÎèÑ Î°úÎî© Ï§ë...
                </div>
            </div>
        </div>

        <!-- ÏßÄÎèÑ ÏòÅÏó≠ -->
        <div class="map-wrapper">
            <div class="map-container">
                <div id="map"></div>
            </div>
        </div>
    </main>

    <footer class="app-footer">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-company">
                    <strong>Ïù∏ÌòïÎΩëÍ∏∞Î∞©</strong>
                    ¬© 2025 All rights reserved.
                </div>
                <div class="footer-links">
                    <a href="#">Ïù¥Ïö©ÏïΩÍ¥Ä</a>
                    <a href="#">Í∞úÏù∏Ï†ïÎ≥¥Ï≤òÎ¶¨Î∞©Ïπ®</a>
                    <a href="#">Í≥†Í∞ùÏÑºÌÑ∞</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Mobile menu toggle
        document.getElementById('mobileMenuBtn')?.addEventListener('click', function() {
            const nav = document.getElementById('headerNav');
            nav.classList.toggle('mobile-open');
        });

        // Ïπ¥Ïπ¥Ïò§Îßµ API ÎèôÏ†Å Î°úÎìú
        (function() {
            const script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = 'https://dapi.kakao.com/v2/maps/sdk.js?appkey=719ae502dd3351fab0a5fa57689ef5cd&libraries=services,clusterer&autoload=false';
            script.onload = function() {
                console.log('‚úÖ Ïπ¥Ïπ¥Ïò§Îßµ Ïä§ÌÅ¨Î¶ΩÌä∏ Î°úÎìú ÏÑ±Í≥µ');
            };
            script.onerror = function() {
                console.error('‚ùå Ïπ¥Ïπ¥Ïò§Îßµ Ïä§ÌÅ¨Î¶ΩÌä∏ Î°úÎìú Ïã§Ìå®');
                document.getElementById('shopCount').textContent = 'Ïπ¥Ïπ¥Ïò§Îßµ API Î°úÎìú Ïã§Ìå®. ÎÑ§Ìä∏ÏõåÌÅ¨Î•º ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.';
            };
            document.head.appendChild(script);
        })();

        // Ïπ¥Ïπ¥Ïò§Îßµ Í¥ÄÎ†® Î≥ÄÏàò
        let map;
        let clusterer;
        let markers = [];
        let infowindow;
        let ps; // Places ÏÑúÎπÑÏä§ Í∞ùÏ≤¥
        let allShops = []; // Í≤ÄÏÉâÎêú Î™®Îì† Í∞ÄÍ≤å Ï†ïÎ≥¥
        let currentRegion = 'ÏÑúÏö∏ÌäπÎ≥ÑÏãú'; // ÌòÑÏû¨ ÏÑ†ÌÉùÎêú ÏßÄÏó≠

        // ÏßÄÏó≠Î≥Ñ Í≤ÄÏÉâ ÏßÄÏ†ê Îß§Ìïë
        const regionSearchPoints = {
            'ÏÑúÏö∏ÌäπÎ≥ÑÏãú': [
                { name: 'Í∞ïÎÇ®1', lat: 37.4979, lng: 127.0276 },
                { name: 'Í∞ïÎÇ®2', lat: 37.5172, lng: 127.0473 },
                { name: 'Í∞ïÎÇ®3', lat: 37.4846, lng: 127.0325 },
                { name: 'ÌôçÎåÄ', lat: 37.5563, lng: 126.9244 },
                { name: 'Ïã†Ï¥å', lat: 37.5564, lng: 126.9369 },
                { name: 'Î™ÖÎèô', lat: 37.5636, lng: 126.9834 },
                { name: 'Ïû†Ïã§', lat: 37.5133, lng: 127.1000 },
                { name: 'Í±¥ÎåÄ', lat: 37.5402, lng: 127.0695 },
                { name: 'Ïù¥ÌÉúÏõê', lat: 37.5345, lng: 126.9949 },
                { name: 'Ï¢ÖÎ°ú', lat: 37.5704, lng: 126.9910 },
                { name: 'Í∞ïÎ∂Å', lat: 37.6396, lng: 127.0255 },
                { name: 'ÏòÅÎì±Ìè¨', lat: 37.5264, lng: 126.8962 },
                { name: 'Íµ¨Î°ú', lat: 37.4954, lng: 126.8876 },
                { name: 'ÎÖ∏Ïõê', lat: 37.6542, lng: 127.0568 },
                { name: 'ÏÜ°Ìåå', lat: 37.5145, lng: 127.1059 },
                { name: 'Í∞ïÎèô', lat: 37.5301, lng: 127.1238 },
                { name: 'ÎßàÌè¨', lat: 37.5663, lng: 126.9019 },
                { name: 'Ïö©ÏÇ∞', lat: 37.5326, lng: 126.9900 },
                { name: 'ÏÑ±Î∂Å', lat: 37.5894, lng: 127.0167 },
                { name: 'ÎèôÎåÄÎ¨∏', lat: 37.5744, lng: 127.0395 }
            ],
            'Î∂ÄÏÇ∞Í¥ëÏó≠Ïãú': [
                { name: 'Ìï¥Ïö¥ÎåÄ', lat: 35.1587, lng: 129.1603 },
                { name: 'ÏÑúÎ©¥1', lat: 35.1577, lng: 129.0595 },
                { name: 'ÏÑúÎ©¥2', lat: 35.1541, lng: 129.0631 },
                { name: 'Í¥ëÏïàÎ¶¨', lat: 35.1532, lng: 129.1189 },
                { name: 'ÎÇ®Ìè¨Îèô', lat: 35.0971, lng: 129.0287 },
                { name: 'Î∂ÄÏÇ∞Ïó≠', lat: 35.1156, lng: 129.0403 },
                { name: 'ÏÑºÌÖÄ', lat: 35.1691, lng: 129.1311 },
                { name: 'ÎèôÎûò', lat: 35.2048, lng: 129.0785 },
                { name: 'ÏÇ¨ÏÉÅ', lat: 35.1508, lng: 128.9907 }
            ],
            'ÎåÄÍµ¨Í¥ëÏó≠Ïãú': [
                { name: 'ÎèôÏÑ±Î°ú', lat: 35.8695, lng: 128.5934 },
                { name: 'ÏàòÏÑ±Íµ¨', lat: 35.8242, lng: 128.6308 },
                { name: 'ÎëêÎ•ò', lat: 35.8532, lng: 128.5657 },
                { name: 'Ïπ†ÏÑ±', lat: 35.8854, lng: 128.5905 }
            ],
            'Ïù∏Ï≤úÍ¥ëÏó≠Ïãú': [
                { name: 'ÏÜ°ÎèÑ', lat: 37.3786, lng: 126.6562 },
                { name: 'Î∂ÄÌèâ', lat: 37.5077, lng: 126.7236 },
                { name: 'Íµ¨ÏõîÎèô', lat: 37.4454, lng: 126.7052 },
                { name: 'Ï£ºÏïà', lat: 37.4638, lng: 126.6791 }
            ],
            'ÎåÄÏ†ÑÍ¥ëÏó≠Ïãú': [
                // Ïú†ÏÑ±Íµ¨
                { name: 'Ïú†ÏÑ±Ïò®Ï≤ú', lat: 36.3566, lng: 127.3423 },
                { name: 'Î¥âÎ™ÖÎèô', lat: 36.3689, lng: 127.3445 },
                { name: 'ÎÖ∏ÏùÄÎèô', lat: 36.3686, lng: 127.3384 },
                { name: 'Ï†ÑÎØºÎèô', lat: 36.3450, lng: 127.3680 },  // Ï†ÑÎØºÏ†ê Í∑ºÏ≤ò Ï∂îÍ∞Ä
                { name: 'ÎèÑÎ£°Îèô', lat: 36.3641, lng: 127.3490 },
                { name: 'Í∂ÅÎèô', lat: 36.3729, lng: 127.3634 },
                // ÏÑúÍµ¨
                { name: 'ÎëîÏÇ∞', lat: 36.3504, lng: 127.3845 },
                { name: 'ÌÉÑÎ∞©Îèô', lat: 36.3450, lng: 127.3748 },
                { name: 'ÏõîÌèâÎèô', lat: 36.3628, lng: 127.3597 },
                // Ï§ëÍµ¨
                { name: 'ÏùÄÌñâÎèô', lat: 36.3273, lng: 127.4295 },
                { name: 'ÎåÄÌù•Îèô', lat: 36.3262, lng: 127.4237 },
                // ÎèôÍµ¨
                { name: 'Ïã†ÏïàÎèô', lat: 36.3561, lng: 127.4369 },
                // ÎåÄÎçïÍµ¨
                { name: 'Ï§ëÎ¶¨Îèô', lat: 36.3693, lng: 127.4147 }
            ],
            'Í¥ëÏ£ºÍ¥ëÏó≠Ïãú': [
                { name: 'Ï∂©Ïû•Î°ú', lat: 35.1492, lng: 126.9172 },
                { name: 'ÏÉÅÎ¨¥', lat: 35.1520, lng: 126.8533 }
            ],
            'Ïö∏ÏÇ∞Í¥ëÏó≠Ïãú': [
                { name: 'ÏÇºÏÇ∞', lat: 35.5372, lng: 129.3390 },
                { name: 'Ïö∏ÏÇ∞Ïó≠', lat: 35.5379, lng: 129.3314 }
            ],
            'ÏÑ∏Ï¢ÖÌäπÎ≥ÑÏûêÏπòÏãú': [
                { name: 'ÏÑ∏Ï¢Ö', lat: 36.4800, lng: 127.2890 }
            ],
            'Í≤ΩÍ∏∞ÎèÑ': [
                { name: 'ÏàòÏõê1', lat: 37.2661, lng: 127.0015 },
                { name: 'ÏàòÏõê2', lat: 37.2636, lng: 126.9910 },
                { name: 'ÏÑ±ÎÇ®Î∂ÑÎãπ', lat: 37.3941, lng: 127.1111 },
                { name: 'ÏÑ±ÎÇ®Ï§ëÏõê', lat: 37.4201, lng: 127.1262 },
                { name: 'Í≥†ÏñëÏùºÏÇ∞', lat: 37.6638, lng: 126.7684 },
                { name: 'Í≥†ÏñëÎçïÏñë', lat: 37.6584, lng: 126.8320 },
                { name: 'Ïö©Ïù∏Í∏∞Ìù•', lat: 37.2767, lng: 127.1163 },
                { name: 'Ïö©Ïù∏ÏàòÏßÄ', lat: 37.3218, lng: 127.0931 },
                { name: 'Î∂ÄÏ≤ú', lat: 37.5035, lng: 126.7660 },
                { name: 'ÏïàÏÇ∞', lat: 37.3219, lng: 126.8309 },
                { name: 'ÏïàÏñëÌèâÏ¥å', lat: 37.3896, lng: 126.9515 },
                { name: 'ÏïàÏñëÎßåÏïà', lat: 37.3838, lng: 126.9227 },
                { name: 'ÌèâÌÉù', lat: 36.9921, lng: 127.1129 },
                { name: 'ÏùòÏ†ïÎ∂Ä', lat: 37.7382, lng: 127.0336 },
                { name: 'ÏãúÌù•', lat: 37.3800, lng: 126.8028 },
                { name: 'ÌååÏ£º', lat: 37.7608, lng: 126.7800 },
                { name: 'ÍπÄÌè¨', lat: 37.6152, lng: 126.7157 },
                { name: 'Í¥ëÎ™Ö', lat: 37.4786, lng: 126.8644 },
                { name: 'ÌïòÎÇ®', lat: 37.5393, lng: 127.2147 }
            ],
            'Í∞ïÏõêÌäπÎ≥ÑÏûêÏπòÎèÑ': [
                { name: 'Ï∂òÏ≤ú', lat: 37.8813, lng: 127.7298 },
                { name: 'ÏõêÏ£º', lat: 37.3422, lng: 127.9202 },
                { name: 'Í∞ïÎ¶â', lat: 37.7519, lng: 128.8761 }
            ],
            'Ï∂©Ï≤≠Î∂ÅÎèÑ': [
                { name: 'Ï≤≠Ï£º', lat: 36.6424, lng: 127.4890 }
            ],
            'Ï∂©Ï≤≠ÎÇ®ÎèÑ': [
                { name: 'Ï≤úÏïà', lat: 36.8151, lng: 127.1139 },
                { name: 'ÏïÑÏÇ∞', lat: 36.7898, lng: 127.0018 }
            ],
            'Ï†ÑÎ∂ÅÌäπÎ≥ÑÏûêÏπòÎèÑ': [
                { name: 'Ï†ÑÏ£º', lat: 35.8242, lng: 127.1480 },
                { name: 'ÏùµÏÇ∞', lat: 35.9483, lng: 126.9575 }
            ],
            'Ï†ÑÎùºÎÇ®ÎèÑ': [
                { name: 'Î™©Ìè¨', lat: 34.8118, lng: 126.3922 },
                { name: 'ÏàúÏ≤ú', lat: 34.9507, lng: 127.4872 },
                { name: 'Ïó¨Ïàò', lat: 34.7604, lng: 127.6622 }
            ],
            'Í≤ΩÏÉÅÎ∂ÅÎèÑ': [
                { name: 'Ìè¨Ìï≠', lat: 36.0190, lng: 129.3435 },
                { name: 'Í≤ΩÏ£º', lat: 35.8562, lng: 129.2247 }
            ],
            'Í≤ΩÏÉÅÎÇ®ÎèÑ': [
                { name: 'Ï∞ΩÏõê', lat: 35.2278, lng: 128.6811 },
                { name: 'ÏßÑÏ£º', lat: 35.1800, lng: 128.1076 },
                { name: 'ÍπÄÌï¥', lat: 35.2285, lng: 128.8894 },
                { name: 'Í±∞Ï†ú', lat: 34.8806, lng: 128.6211 }
            ],
            'Ï†úÏ£ºÌäπÎ≥ÑÏûêÏπòÎèÑ': [
                { name: 'Ï†úÏ£ºÏãú', lat: 33.4996, lng: 126.5312 },
                { name: 'ÏÑúÍ∑ÄÌè¨', lat: 33.2541, lng: 126.5601 }
            ]
        };

        // ÏßÄÏó≠Î≥Ñ ÏßÄÎèÑ Ï§ëÏã¨ Ï¢åÌëú
        const regionCenters = {
            'ÏÑúÏö∏ÌäπÎ≥ÑÏãú': { lat: 37.5665, lng: 126.9780, level: 8 },
            'Î∂ÄÏÇ∞Í¥ëÏó≠Ïãú': { lat: 35.1796, lng: 129.0756, level: 8 },
            'ÎåÄÍµ¨Í¥ëÏó≠Ïãú': { lat: 35.8714, lng: 128.6014, level: 8 },
            'Ïù∏Ï≤úÍ¥ëÏó≠Ïãú': { lat: 37.4563, lng: 126.7052, level: 9 },
            'Í¥ëÏ£ºÍ¥ëÏó≠Ïãú': { lat: 35.1595, lng: 126.8526, level: 8 },
            'ÎåÄÏ†ÑÍ¥ëÏó≠Ïãú': { lat: 36.3504, lng: 127.3845, level: 8 },
            'Ïö∏ÏÇ∞Í¥ëÏó≠Ïãú': { lat: 35.5384, lng: 129.3114, level: 8 },
            'ÏÑ∏Ï¢ÖÌäπÎ≥ÑÏûêÏπòÏãú': { lat: 36.4800, lng: 127.2890, level: 9 },
            'Í≤ΩÍ∏∞ÎèÑ': { lat: 37.4138, lng: 127.5183, level: 10 },
            'Í∞ïÏõêÌäπÎ≥ÑÏûêÏπòÎèÑ': { lat: 37.8228, lng: 128.1555, level: 11 },
            'Ï∂©Ï≤≠Î∂ÅÎèÑ': { lat: 36.6424, lng: 127.4890, level: 10 },
            'Ï∂©Ï≤≠ÎÇ®ÎèÑ': { lat: 36.5184, lng: 126.8000, level: 10 },
            'Ï†ÑÎ∂ÅÌäπÎ≥ÑÏûêÏπòÎèÑ': { lat: 35.7175, lng: 127.1530, level: 10 },
            'Ï†ÑÎùºÎÇ®ÎèÑ': { lat: 34.8679, lng: 126.9910, level: 10 },
            'Í≤ΩÏÉÅÎ∂ÅÎèÑ': { lat: 36.4919, lng: 128.8889, level: 11 },
            'Í≤ΩÏÉÅÎÇ®ÎèÑ': { lat: 35.4606, lng: 128.2132, level: 10 },
            'Ï†úÏ£ºÌäπÎ≥ÑÏûêÏπòÎèÑ': { lat: 33.4890, lng: 126.4983, level: 10 }
        };

        // ÏãúÎèÑÎ≥Ñ ÏãúÍµ∞Íµ¨ Îç∞Ïù¥ÌÑ∞
        const sigunguData = {
            'ÏÑúÏö∏ÌäπÎ≥ÑÏãú': ['Í∞ïÎÇ®Íµ¨', 'Í∞ïÎèôÍµ¨', 'Í∞ïÎ∂ÅÍµ¨', 'Í∞ïÏÑúÍµ¨', 'Í¥ÄÏïÖÍµ¨', 'Í¥ëÏßÑÍµ¨', 'Íµ¨Î°úÍµ¨', 'Í∏àÏ≤úÍµ¨', 'ÎÖ∏ÏõêÍµ¨', 'ÎèÑÎ¥âÍµ¨', 'ÎèôÎåÄÎ¨∏Íµ¨', 'ÎèôÏûëÍµ¨', 'ÎßàÌè¨Íµ¨', 'ÏÑúÎåÄÎ¨∏Íµ¨', 'ÏÑúÏ¥àÍµ¨', 'ÏÑ±ÎèôÍµ¨', 'ÏÑ±Î∂ÅÍµ¨', 'ÏÜ°ÌååÍµ¨', 'ÏñëÏ≤úÍµ¨', 'ÏòÅÎì±Ìè¨Íµ¨', 'Ïö©ÏÇ∞Íµ¨', 'ÏùÄÌèâÍµ¨', 'Ï¢ÖÎ°úÍµ¨', 'Ï§ëÍµ¨', 'Ï§ëÎûëÍµ¨'],
            'Î∂ÄÏÇ∞Í¥ëÏó≠Ïãú': ['Í∞ïÏÑúÍµ¨', 'Í∏àÏ†ïÍµ¨', 'Í∏∞Ïû•Íµ∞', 'ÎÇ®Íµ¨', 'ÎèôÍµ¨', 'ÎèôÎûòÍµ¨', 'Î∂ÄÏÇ∞ÏßÑÍµ¨', 'Î∂ÅÍµ¨', 'ÏÇ¨ÏÉÅÍµ¨', 'ÏÇ¨ÌïòÍµ¨', 'ÏÑúÍµ¨', 'ÏàòÏòÅÍµ¨', 'Ïó∞Ï†úÍµ¨', 'ÏòÅÎèÑÍµ¨', 'Ï§ëÍµ¨', 'Ìï¥Ïö¥ÎåÄÍµ¨'],
            'ÎåÄÍµ¨Í¥ëÏó≠Ïãú': ['ÎÇ®Íµ¨', 'Îã¨ÏÑúÍµ¨', 'Îã¨ÏÑ±Íµ∞', 'ÎèôÍµ¨', 'Î∂ÅÍµ¨', 'ÏÑúÍµ¨', 'ÏàòÏÑ±Íµ¨', 'Ï§ëÍµ¨'],
            'Ïù∏Ï≤úÍ¥ëÏó≠Ïãú': ['Í∞ïÌôîÍµ∞', 'Í≥ÑÏñëÍµ¨', 'ÎÇ®ÎèôÍµ¨', 'ÎèôÍµ¨', 'ÎØ∏Ï∂îÌôÄÍµ¨', 'Î∂ÄÌèâÍµ¨', 'ÏÑúÍµ¨', 'Ïó∞ÏàòÍµ¨', 'ÏòπÏßÑÍµ∞', 'Ï§ëÍµ¨'],
            'Í¥ëÏ£ºÍ¥ëÏó≠Ïãú': ['Í¥ëÏÇ∞Íµ¨', 'ÎÇ®Íµ¨', 'ÎèôÍµ¨', 'Î∂ÅÍµ¨', 'ÏÑúÍµ¨'],
            'ÎåÄÏ†ÑÍ¥ëÏó≠Ïãú': ['ÎåÄÎçïÍµ¨', 'ÎèôÍµ¨', 'ÏÑúÍµ¨', 'Ïú†ÏÑ±Íµ¨', 'Ï§ëÍµ¨'],
            'Ïö∏ÏÇ∞Í¥ëÏó≠Ïãú': ['ÎÇ®Íµ¨', 'ÎèôÍµ¨', 'Î∂ÅÍµ¨', 'Ïö∏Ï£ºÍµ∞', 'Ï§ëÍµ¨'],
            'ÏÑ∏Ï¢ÖÌäπÎ≥ÑÏûêÏπòÏãú': ['ÏÑ∏Ï¢ÖÏãú'],
            'Í≤ΩÍ∏∞ÎèÑ': ['Í∞ÄÌèâÍµ∞', 'Í≥†ÏñëÏãú', 'Í≥ºÏ≤úÏãú', 'Í¥ëÎ™ÖÏãú', 'Í¥ëÏ£ºÏãú', 'Íµ¨Î¶¨Ïãú', 'Íµ∞Ìè¨Ïãú', 'ÍπÄÌè¨Ïãú', 'ÎÇ®ÏñëÏ£ºÏãú', 'ÎèôÎëêÏ≤úÏãú', 'Î∂ÄÏ≤úÏãú', 'ÏÑ±ÎÇ®Ïãú', 'ÏàòÏõêÏãú', 'ÏãúÌù•Ïãú', 'ÏïàÏÇ∞Ïãú', 'ÏïàÏÑ±Ïãú', 'ÏïàÏñëÏãú', 'ÏñëÏ£ºÏãú', 'ÏñëÌèâÍµ∞', 'Ïó¨Ï£ºÏãú', 'Ïó∞Ï≤úÍµ∞', 'Ïò§ÏÇ∞Ïãú', 'Ïö©Ïù∏Ïãú', 'ÏùòÏôïÏãú', 'ÏùòÏ†ïÎ∂ÄÏãú', 'Ïù¥Ï≤úÏãú', 'ÌååÏ£ºÏãú', 'ÌèâÌÉùÏãú', 'Ìè¨Ï≤úÏãú', 'ÌïòÎÇ®Ïãú', 'ÌôîÏÑ±Ïãú'],
            'Í∞ïÏõêÌäπÎ≥ÑÏûêÏπòÎèÑ': ['Í∞ïÎ¶âÏãú', 'Í≥†ÏÑ±Íµ∞', 'ÎèôÌï¥Ïãú', 'ÏÇºÏ≤ôÏãú', 'ÏÜçÏ¥àÏãú', 'ÏñëÍµ¨Íµ∞', 'ÏñëÏñëÍµ∞', 'ÏòÅÏõîÍµ∞', 'ÏõêÏ£ºÏãú', 'Ïù∏Ï†úÍµ∞', 'Ï†ïÏÑ†Íµ∞', 'Ï≤†ÏõêÍµ∞', 'Ï∂òÏ≤úÏãú', 'ÌÉúÎ∞±Ïãú', 'ÌèâÏ∞ΩÍµ∞', 'ÌôçÏ≤úÍµ∞', 'ÌôîÏ≤úÍµ∞', 'Ìö°ÏÑ±Íµ∞'],
            'Ï∂©Ï≤≠Î∂ÅÎèÑ': ['Í¥¥ÏÇ∞Íµ∞', 'Îã®ÏñëÍµ∞', 'Î≥¥ÏùÄÍµ∞', 'ÏòÅÎèôÍµ∞', 'Ïò•Ï≤úÍµ∞', 'ÏùåÏÑ±Íµ∞', 'Ï†úÏ≤úÏãú', 'Ï¶ùÌèâÍµ∞', 'ÏßÑÏ≤úÍµ∞', 'Ï≤≠Ï£ºÏãú', 'Ï∂©Ï£ºÏãú'],
            'Ï∂©Ï≤≠ÎÇ®ÎèÑ': ['Í≥ÑÎ£°Ïãú', 'Í≥µÏ£ºÏãú', 'Í∏àÏÇ∞Íµ∞', 'ÎÖºÏÇ∞Ïãú', 'ÎãπÏßÑÏãú', 'Î≥¥Î†πÏãú', 'Î∂ÄÏó¨Íµ∞', 'ÏÑúÏÇ∞Ïãú', 'ÏÑúÏ≤úÍµ∞', 'ÏïÑÏÇ∞Ïãú', 'ÏòàÏÇ∞Íµ∞', 'Ï≤úÏïàÏãú', 'Ï≤≠ÏñëÍµ∞', 'ÌÉúÏïàÍµ∞', 'ÌôçÏÑ±Íµ∞'],
            'Ï†ÑÎ∂ÅÌäπÎ≥ÑÏûêÏπòÎèÑ': ['Í≥†Ï∞ΩÍµ∞', 'Íµ∞ÏÇ∞Ïãú', 'ÍπÄÏ†úÏãú', 'ÎÇ®ÏõêÏãú', 'Î¨¥Ï£ºÍµ∞', 'Î∂ÄÏïàÍµ∞', 'ÏàúÏ∞ΩÍµ∞', 'ÏôÑÏ£ºÍµ∞', 'ÏùµÏÇ∞Ïãú', 'ÏûÑÏã§Íµ∞', 'Ïû•ÏàòÍµ∞', 'Ï†ÑÏ£ºÏãú', 'Ï†ïÏùçÏãú', 'ÏßÑÏïàÍµ∞'],
            'Ï†ÑÎùºÎÇ®ÎèÑ': ['Í∞ïÏßÑÍµ∞', 'Í≥†Ìù•Íµ∞', 'Í≥°ÏÑ±Íµ∞', 'Í¥ëÏñëÏãú', 'Íµ¨Î°ÄÍµ∞', 'ÎÇòÏ£ºÏãú', 'Îã¥ÏñëÍµ∞', 'Î™©Ìè¨Ïãú', 'Î¨¥ÏïàÍµ∞', 'Î≥¥ÏÑ±Íµ∞', 'ÏàúÏ≤úÏãú', 'Ïã†ÏïàÍµ∞', 'Ïó¨ÏàòÏãú', 'ÏòÅÍ¥ëÍµ∞', 'ÏòÅÏïîÍµ∞', 'ÏôÑÎèÑÍµ∞', 'Ïû•ÏÑ±Íµ∞', 'Ïû•Ìù•Íµ∞', 'ÏßÑÎèÑÍµ∞', 'Ìï®ÌèâÍµ∞', 'Ìï¥ÎÇ®Íµ∞', 'ÌôîÏàúÍµ∞'],
            'Í≤ΩÏÉÅÎ∂ÅÎèÑ': ['Í≤ΩÏÇ∞Ïãú', 'Í≤ΩÏ£ºÏãú', 'Í≥†Î†πÍµ∞', 'Íµ¨ÎØ∏Ïãú', 'Íµ∞ÏúÑÍµ∞', 'ÍπÄÏ≤úÏãú', 'Î¨∏Í≤ΩÏãú', 'Î¥âÌôîÍµ∞', 'ÏÉÅÏ£ºÏãú', 'ÏÑ±Ï£ºÍµ∞', 'ÏïàÎèôÏãú', 'ÏòÅÎçïÍµ∞', 'ÏòÅÏñëÍµ∞', 'ÏòÅÏ£ºÏãú', 'ÏòÅÏ≤úÏãú', 'ÏòàÏ≤úÍµ∞', 'Ïö∏Î¶âÍµ∞', 'Ïö∏ÏßÑÍµ∞', 'ÏùòÏÑ±Íµ∞', 'Ï≤≠ÎèÑÍµ∞', 'Ï≤≠ÏÜ°Íµ∞', 'Ïπ†Í≥°Íµ∞', 'Ìè¨Ìï≠Ïãú'],
            'Í≤ΩÏÉÅÎÇ®ÎèÑ': ['Í±∞Ï†úÏãú', 'Í±∞Ï∞ΩÍµ∞', 'Í≥†ÏÑ±Íµ∞', 'ÍπÄÌï¥Ïãú', 'ÎÇ®Ìï¥Íµ∞', 'Î∞ÄÏñëÏãú', 'ÏÇ¨Ï≤úÏãú', 'ÏÇ∞Ï≤≠Íµ∞', 'ÏñëÏÇ∞Ïãú', 'ÏùòÎ†πÍµ∞', 'ÏßÑÏ£ºÏãú', 'Ï∞ΩÎÖïÍµ∞', 'Ï∞ΩÏõêÏãú', 'ÌÜµÏòÅÏãú', 'ÌïòÎèôÍµ∞', 'Ìï®ÏïàÍµ∞', 'Ìï®ÏñëÍµ∞', 'Ìï©Ï≤úÍµ∞'],
            'Ï†úÏ£ºÌäπÎ≥ÑÏûêÏπòÎèÑ': ['ÏÑúÍ∑ÄÌè¨Ïãú', 'Ï†úÏ£ºÏãú']
        };

        // ÏãúÍµ∞Íµ¨Î≥Ñ Ï§ëÏã¨ Ï¢åÌëú (Ï£ºÏöî Í¥ëÏó≠Ïãú)
        const sigunguCenters = {
            // ÎåÄÏ†ÑÍ¥ëÏó≠Ïãú
            'ÎåÄÏ†ÑÍ¥ëÏó≠Ïãú-ÎåÄÎçïÍµ¨': { lat: 36.3693, lng: 127.4147, level: 7 },
            'ÎåÄÏ†ÑÍ¥ëÏó≠Ïãú-ÎèôÍµ¨': { lat: 36.3393, lng: 127.4458, level: 7 },
            'ÎåÄÏ†ÑÍ¥ëÏó≠Ïãú-ÏÑúÍµ¨': { lat: 36.3504, lng: 127.3845, level: 7 },
            'ÎåÄÏ†ÑÍ¥ëÏó≠Ïãú-Ïú†ÏÑ±Íµ¨': { lat: 36.3566, lng: 127.3423, level: 7 },
            'ÎåÄÏ†ÑÍ¥ëÏó≠Ïãú-Ï§ëÍµ¨': { lat: 36.3273, lng: 127.4295, level: 7 },
            // ÏÑúÏö∏ÌäπÎ≥ÑÏãú (Ï£ºÏöî Íµ¨)
            'ÏÑúÏö∏ÌäπÎ≥ÑÏãú-Í∞ïÎÇ®Íµ¨': { lat: 37.5172, lng: 127.0473, level: 7 },
            'ÏÑúÏö∏ÌäπÎ≥ÑÏãú-Í∞ïÏÑúÍµ¨': { lat: 37.5509, lng: 126.8495, level: 7 },
            'ÏÑúÏö∏ÌäπÎ≥ÑÏãú-ÏÜ°ÌååÍµ¨': { lat: 37.5145, lng: 127.1059, level: 7 },
            'ÏÑúÏö∏ÌäπÎ≥ÑÏãú-ÎßàÌè¨Íµ¨': { lat: 37.5663, lng: 126.9019, level: 7 },
            // Î∂ÄÏÇ∞Í¥ëÏó≠Ïãú
            'Î∂ÄÏÇ∞Í¥ëÏó≠Ïãú-Ìï¥Ïö¥ÎåÄÍµ¨': { lat: 35.1587, lng: 129.1603, level: 7 },
            'Î∂ÄÏÇ∞Í¥ëÏó≠Ïãú-Î∂ÄÏÇ∞ÏßÑÍµ¨': { lat: 35.1577, lng: 129.0595, level: 7 },
            'Î∂ÄÏÇ∞Í¥ëÏó≠Ïãú-ÎÇ®Íµ¨': { lat: 35.1363, lng: 129.0847, level: 7 },
            'Î∂ÄÏÇ∞Í¥ëÏó≠Ïãú-ÎèôÎûòÍµ¨': { lat: 35.2048, lng: 129.0785, level: 7 }
        };

        // ÏßÄÎèÑ Ï¥àÍ∏∞Ìôî
        function initMap() {
            const container = document.getElementById('map');
            const options = {
                center: new kakao.maps.LatLng(37.5665, 126.9780), // ÏÑúÏö∏ Ï§ëÏã¨
                level: 8 // ÏÑúÏö∏ Ï†ÑÏ≤¥Í∞Ä Î≥¥Ïù¥Îäî Î†àÎ≤®
            };

            map = new kakao.maps.Map(container, options);
            infowindow = new kakao.maps.InfoWindow({zIndex: 1});
            ps = new kakao.maps.services.Places();

            // ÎßàÏª§ ÌÅ¥Îü¨Ïä§ÌÑ∞Îü¨ Ï¥àÍ∏∞Ìôî
            clusterer = new kakao.maps.MarkerClusterer({
                map: map,
                averageCenter: true,
                minLevel: 5,
                calculator: [10, 30, 50],
                styles: [{
                    width: '50px',
                    height: '50px',
                    background: '#6200ea',
                    borderRadius: '25px',
                    color: '#fff',
                    textAlign: 'center',
                    lineHeight: '50px',
                    fontSize: '14px',
                    fontWeight: 'bold',
                    boxShadow: '0 2px 4px rgba(0,0,0,0.3)'
                }, {
                    width: '60px',
                    height: '60px',
                    background: '#3700b3',
                    borderRadius: '30px',
                    color: '#fff',
                    textAlign: 'center',
                    lineHeight: '60px',
                    fontSize: '16px',
                    fontWeight: 'bold',
                    boxShadow: '0 2px 6px rgba(0,0,0,0.3)'
                }, {
                    width: '70px',
                    height: '70px',
                    background: '#1a0052',
                    borderRadius: '35px',
                    color: '#fff',
                    textAlign: 'center',
                    lineHeight: '70px',
                    fontSize: '18px',
                    fontWeight: 'bold',
                    boxShadow: '0 3px 8px rgba(0,0,0,0.3)'
                }]
            });

            // ÏßÄÎèÑ Ïù¥Îèô/ÌôïÎåÄ/Ï∂ïÏÜå Ïù¥Î≤§Ìä∏ Îì±Î°ù
            kakao.maps.event.addListener(map, 'idle', function() {
                updateShopCount();
            });

            // Í∏∞Î≥∏ ÏßÄÏó≠(ÏÑúÏö∏) ÏãúÍµ∞Íµ¨ Î™©Î°ù Ï¥àÍ∏∞Ìôî
            updateSigunguSelect('ÏÑúÏö∏ÌäπÎ≥ÑÏãú');

            // Í∏∞Î≥∏ ÏßÄÏó≠(ÏÑúÏö∏) Ïù∏ÌòïÎΩëÍ∏∞ Í∞ÄÍ≤å Í≤ÄÏÉâ
            searchDollCatcherShops('ÏÑúÏö∏ÌäπÎ≥ÑÏãú');
        }

        // Í≤ÄÏÉâ ÏÉÅÌÉú Î≥ÄÏàò
        let searchState = {
            sido: '',
            sigungu: null,
            searchedCount: 0,
            totalRegions: 0,
            totalApiCalls: 0
        };

        // Ïù∏ÌòïÎΩëÍ∏∞ Í∞ÄÍ≤å Í≤ÄÏÉâ (ÏßÄÏó≠Î≥Ñ)
        function searchDollCatcherShops(region, sigungu = null) {
            currentRegion = sigungu ? `${region} ${sigungu}` : region;
            const displayText = sigungu ? `${region} ${sigungu}` : region;
            document.getElementById('shopCount').textContent = `${displayText} Í≤ÄÏÉâ Ï§ë...`;

            // Í≤ÄÏÉâ ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
            searchState = {
                sido: region,
                sigungu: sigungu,
                searchedCount: 0,
                totalRegions: 0,
                totalApiCalls: 0
            };

            // Í∏∞Ï°¥ ÎßàÏª§ Ï†úÍ±∞
            clusterer.clear();
            markers = [];
            allShops = [];

            // ÏÑ†ÌÉùÎêú ÏßÄÏó≠Ïùò Í≤ÄÏÉâ ÏßÄÏ†ê Í∞ÄÏ†∏Ïò§Í∏∞
            const regions = regionSearchPoints[region] || [];

            if (regions.length === 0) {
                document.getElementById('shopCount').textContent = `${displayText} Í≤ÄÏÉâ ÏßÄÏ†êÏù¥ ÏóÜÏäµÎãàÎã§.`;
                return;
            }

            searchState.totalRegions = regions.length;

            // ÏßÄÎèÑ Ï§ëÏã¨ Ïù¥Îèô
            let centerCoords;
            if (sigungu) {
                // ÏãúÍµ∞Íµ¨ ÏÑ†ÌÉù Ïãú Ìï¥Îãπ Íµ¨Ïùò Ï§ëÏã¨Ï¢åÌëú ÏÇ¨Ïö©
                const sigunguKey = `${region}-${sigungu}`;
                centerCoords = sigunguCenters[sigunguKey] || regionCenters[region];
            } else {
                // ÏãúÎèÑÎßå ÏÑ†ÌÉù Ïãú ÏãúÎèÑ Ï§ëÏã¨Ï¢åÌëú ÏÇ¨Ïö©
                centerCoords = regionCenters[region];
            }

            if (centerCoords) {
                map.setCenter(new kakao.maps.LatLng(centerCoords.lat, centerCoords.lng));
                map.setLevel(centerCoords.level);
            }

            // Í≤ÄÏÉâÌï† ÌÇ§ÏõåÎìú Î™©Î°ù
            const keywords = ['Ïù∏ÌòïÎΩëÍ∏∞', 'Ïù∏Ìòï', 'ÎΩëÍ∏∞'];  //

            // Í∞Å ÏßÄÏó≠Î≥ÑÎ°ú Ïó¨Îü¨ ÌÇ§ÏõåÎìúÎ°ú Í≤ÄÏÉâ
            let searchIndex = 0;
            regions.forEach((point, regionIndex) => {
                keywords.forEach((keyword, kwIndex) => {
                    setTimeout(() => {
                        const center = new kakao.maps.LatLng(point.lat, point.lng);
                        searchWithPagination(center, point.name, keyword, 1);
                    }, searchIndex * 120); // API Ìò∏Ï∂ú Í∞ÑÍ≤© 120ms
                    searchIndex++;
                });
            });

            // Ï¥ù Í≤ÄÏÉâ Ïàò ÏóÖÎç∞Ïù¥Ìä∏
            searchState.totalRegions = regions.length * keywords.length;
        }

        // ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖòÏùÑ Ìè¨Ìï®Ìïú Í≤ÄÏÉâ Ìï®Ïàò
        function searchWithPagination(center, regionName, keyword, pageNum) {
            ps.keywordSearch(keyword, function(data, status, pagination) {
                searchState.totalApiCalls++;

                if (status === kakao.maps.services.Status.OK) {
                    // Í≤ÄÏÉâ Í≤∞Í≥º Î°úÍ∑∏
                    if (data.length > 0) {
                        console.log(`üîç [${regionName}] "${keyword}" Í≤ÄÏÉâ: ${data.length}Í∞ú Î∞úÍ≤¨`);
                    }

                    data.forEach(place => {
                        // Ï§ëÎ≥µ Ï≤¥ÌÅ¨ (IDÎ°ú ÌôïÏã§ÌïòÍ≤å)
                        const isDuplicate = allShops.some(shop => shop.id === place.id);

                        if (!isDuplicate) {
                            // ÏãúÍµ∞Íµ¨ ÌïÑÌÑ∞ÎßÅÏù¥ ÌôúÏÑ±ÌôîÎêú Í≤ΩÏö∞ Ï£ºÏÜå Ï≤¥ÌÅ¨
                            let shouldAdd = true;
                            if (searchState.sigungu) {
                                const addressMatch = place.address_name?.includes(searchState.sigungu) ||
                                                    place.road_address_name?.includes(searchState.sigungu);
                                shouldAdd = addressMatch;

                                // ÌïÑÌÑ∞ÎßÅ Î°úÍ∑∏ (Ïú†ÏÑ±Íµ¨ Í≤ÄÏÉâ ÏãúÎßå)
                                if (searchState.sido === 'ÎåÄÏ†ÑÍ¥ëÏó≠Ïãú' && searchState.sigungu === 'Ïú†ÏÑ±Íµ¨') {
                                    if (addressMatch) {
                                        console.log(`  ‚úÖ Ï∂îÍ∞Ä: ${place.place_name} (${place.address_name || place.road_address_name})`);
                                    } else {
                                        console.log(`  ‚ùå Ï†úÏô∏: ${place.place_name} (${place.address_name || place.road_address_name})`);
                                    }
                                }
                            }

                            if (shouldAdd) {
                                allShops.push(place);

                                const position = new kakao.maps.LatLng(place.y, place.x);
                                const marker = new kakao.maps.Marker({
                                    position: position,
                                    title: place.place_name
                                });

                                // ÎßàÏª§ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
                                kakao.maps.event.addListener(marker, 'click', function() {
                                    displayKakaoPlaceInfo(place, marker);
                                });

                                markers.push(marker);
                            }
                        }
                    });

                    // Îã§Ïùå ÌéòÏù¥ÏßÄÍ∞Ä ÏûàÍ≥† 3ÌéòÏù¥ÏßÄ(45Í∞ú) ÎØ∏ÎßåÏù¥Î©¥ Í≥ÑÏÜç Í≤ÄÏÉâ
                    if (pagination.hasNextPage && pageNum < 3) {
                        setTimeout(() => {
                            pagination.nextPage();
                        }, 100);
                    } else {
                        searchState.searchedCount++;
                        updateProgress();
                    }
                } else {
                    searchState.searchedCount++;
                    updateProgress();
                }
            }, {
                location: center,
                radius: 20000, // 20km Î∞òÍ≤Ω    Ïä§ÌéôÏÉÅ 0~20000ÍπåÏßÄ Í∞ÄÎä•
                size: 15
            });
        }

        // Í≤ÄÏÉâ ÏßÑÌñâ ÏÉÅÌô© ÏóÖÎç∞Ïù¥Ìä∏
        function updateProgress() {
            const displayText = searchState.sigungu ?
                `${searchState.sido} ${searchState.sigungu}` : searchState.sido;

            document.getElementById('shopCount').textContent =
                `${displayText} Í≤ÄÏÉâ Ï§ë... ${searchState.searchedCount}/${searchState.totalRegions} (${allShops.length}Í∞ú)`;

            // Î™®Îì† ÏßÄÏó≠ Í≤ÄÏÉâ ÏôÑÎ£å Ïãú
            if (searchState.searchedCount === searchState.totalRegions) {
                setTimeout(() => {
                    let filteredMarkers = markers;

                    // ÏãúÍµ∞Íµ¨ ÌïÑÌÑ∞ÎßÅ
                    if (searchState.sigungu) {
                        const filteredIndices = [];
                        allShops.forEach((shop, idx) => {
                            if (shop.address_name?.includes(searchState.sigungu) ||
                                shop.road_address_name?.includes(searchState.sigungu)) {
                                filteredIndices.push(idx);
                            }
                        });

                        filteredMarkers = filteredIndices.map(idx => markers[idx]);
                        console.log(`‚úÖ ${searchState.sigungu} ÌïÑÌÑ∞ÎßÅ: ${filteredMarkers.length}Í∞ú`);
                    }

                    clusterer.addMarkers(filteredMarkers);
                    updateShopCount();

                    console.log(`‚úÖ Í≤ÄÏÉâ ÏôÑÎ£å!`);
                    console.log(`- Ï¥ù ${allShops.length}Í∞úÏùò Ïù∏ÌòïÎΩëÍ∏∞ Í∞ÄÍ≤å Î∞úÍ≤¨`);
                    console.log(`- ${searchState.totalRegions}Í∞ú ÏßÄÏó≠ Í≤ÄÏÉâ`);
                    console.log(`- ${searchState.totalApiCalls}Ìöå API Ìò∏Ï∂ú`);
                }, 500);
            }
        }

        // ÌòÑÏû¨ ÏßÄÎèÑ Î≤îÏúÑ ÎÇ¥ Í∞ÄÍ≤å Ïàò ÏóÖÎç∞Ïù¥Ìä∏
        function updateShopCount() {
            const bounds = map.getBounds();
            let filteredShops = allShops;

            // ÏãúÍµ∞Íµ¨ ÌïÑÌÑ∞ÎßÅ
            if (searchState.sigungu) {
                filteredShops = allShops.filter(shop =>
                    shop.address_name?.includes(searchState.sigungu) ||
                    shop.road_address_name?.includes(searchState.sigungu)
                );
            }

            const shopsInView = filteredShops.filter(shop => {
                const position = new kakao.maps.LatLng(shop.y, shop.x);
                return bounds.contain(position);
            });

            const countElement = document.getElementById('shopCount');
            const regionText = currentRegion;
            countElement.textContent = `${regionText}: ${shopsInView.length}Í∞ú (Ï†ÑÏ≤¥: ${filteredShops.length}Í∞ú)`;
        }

        // Ïπ¥Ïπ¥Ïò§ Places API Ïû•ÏÜå Ï†ïÎ≥¥ ÌëúÏãú
        function displayKakaoPlaceInfo(place, marker) {
            const content = `
                <div class="custom-infowindow">
                    <div class="infowindow-header">
                        <div>
                            <div class="infowindow-title">${place.place_name}</div>
                            <div class="infowindow-rating" style="color: #757575; font-size: 13px;">
                                ${place.category_name || ''}
                            </div>
                        </div>
                        <button class="infowindow-close" onclick="closeInfowindow()">
                            <span class="material-icons">close</span>
                        </button>
                    </div>
                    <div class="infowindow-body">
                        <p>
                            <span class="material-icons">location_on</span>
                            ${place.address_name || place.road_address_name}
                        </p>
                        ${place.phone ? `
                        <p>
                            <span class="material-icons">phone</span>
                            ${place.phone}
                        </p>
                        ` : ''}
                    </div>
                    <div class="infowindow-footer">
                        <button class="infowindow-btn infowindow-btn-primary" onclick="openKakaoPlace('${place.place_url}')">
                            <span class="material-icons">info</span>
                            ÏÉÅÏÑ∏Î≥¥Í∏∞
                        </button>
                        <button class="infowindow-btn infowindow-btn-secondary" onclick="getDirections(${place.y}, ${place.x})">
                            <span class="material-icons">directions</span>
                            Í∏∏Ï∞æÍ∏∞
                        </button>
                    </div>
                </div>
            `;

            infowindow.setContent(content);
            infowindow.open(map, marker);
        }

        // Ïù∏Ìè¨ÏúàÎèÑÏö∞ Îã´Í∏∞
        function closeInfowindow() {
            infowindow.close();
        }

        // Ïπ¥Ïπ¥Ïò§Îßµ ÏÉÅÏÑ∏Î≥¥Í∏∞ Ïó¥Í∏∞
        function openKakaoPlace(url) {
            window.open(url, '_blank');
        }

        // Í∏∏Ï∞æÍ∏∞
        function getDirections(lat, lng) {
            const kakaoMapUrl = `https://map.kakao.com/link/to/Î™©Ï†ÅÏßÄ,${lat},${lng}`;
            window.open(kakaoMapUrl, '_blank');
        }

        // ÏãúÎèÑ Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨
        function onSidoChange() {
            const selectedSido = document.getElementById('sidoSelect').value;
            console.log(`üó∫Ô∏è ÏãúÎèÑ Î≥ÄÍ≤Ω: ${selectedSido}`);

            // ÏãúÍµ∞Íµ¨ ÏÖÄÎ†âÌä∏Î∞ïÏä§ ÏóÖÎç∞Ïù¥Ìä∏
            updateSigunguSelect(selectedSido);

            // Ï†ÑÏ≤¥ ÏãúÎèÑ Í≤ÄÏÉâ
            searchDollCatcherShops(selectedSido);
        }

        // ÏãúÍµ∞Íµ¨ ÏÖÄÎ†âÌä∏Î∞ïÏä§ ÏóÖÎç∞Ïù¥Ìä∏
        function updateSigunguSelect(sido) {
            const sigunguSelect = document.getElementById('sigunguSelect');
            sigunguSelect.innerHTML = '<option value="">Ï†ÑÏ≤¥</option>';

            const sigungus = sigunguData[sido] || [];
            sigungus.forEach(sigungu => {
                const option = document.createElement('option');
                option.value = sigungu;
                option.textContent = sigungu;
                sigunguSelect.appendChild(option);
            });
        }

        // ÏãúÍµ∞Íµ¨ Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨
        function onSigunguChange() {
            const selectedSido = document.getElementById('sidoSelect').value;
            const selectedSigungu = document.getElementById('sigunguSelect').value;

            if (selectedSigungu) {
                console.log(`üó∫Ô∏è ÏãúÍµ∞Íµ¨ Î≥ÄÍ≤Ω: ${selectedSido} ${selectedSigungu}`);
                // TODO: ÏãúÍµ∞Íµ¨Î≥Ñ ÌïÑÌÑ∞ÎßÅ (Ï∂îÌõÑ Íµ¨ÌòÑ)
                searchDollCatcherShopsBySigungu(selectedSido, selectedSigungu);
            } else {
                console.log(`üó∫Ô∏è Ï†ÑÏ≤¥ ÏÑ†ÌÉù: ${selectedSido}`);
                searchDollCatcherShops(selectedSido);
            }
        }

        // ÏãúÍµ∞Íµ¨Î≥Ñ Í≤ÄÏÉâ (Ï∂îÌõÑ DB Ïó∞Îèô Ïãú ÏÇ¨Ïö©)
        function searchDollCatcherShopsBySigungu(sido, sigungu) {
            // ÌòÑÏû¨Îäî ÏãúÎèÑÎ≥Ñ Í≤ÄÏÉâ ÌõÑ ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ÏóêÏÑú ÌïÑÌÑ∞ÎßÅ
            // Ï∂îÌõÑ ÏÑúÎ≤Ñ APIÏóêÏÑú ÏãúÍµ∞Íµ¨Î≥Ñ ÌïÑÌÑ∞ÎßÅ ÏßÄÏõê Ïãú ÏàòÏ†ï
            currentRegion = `${sido} ${sigungu}`;
            document.getElementById('shopCount').textContent = `${sido} ${sigungu} Í≤ÄÏÉâ Ï§ë...`;

            // ÏùºÎã® ÏãúÎèÑ Ï†ÑÏ≤¥ Í≤ÄÏÉâ ÌõÑ ÌïÑÌÑ∞ÎßÅ
            searchDollCatcherShops(sido, sigungu);
        }

        // Ïπ¥Ïπ¥Ïò§Îßµ API Î°úÎìú ÌôïÏù∏ Î∞è Ï¥àÍ∏∞Ìôî
        let kakaoLoadAttempts = 0;
        const maxAttempts = 100; // ÏµúÎåÄ 10Ï¥à ÎåÄÍ∏∞

        function waitForKakao() {
            kakaoLoadAttempts++;

            if (window.kakao && window.kakao.maps) {
                console.log('‚úÖ Ïπ¥Ïπ¥Ïò§Îßµ API Í∞ùÏ≤¥ ÌôïÏù∏ ÏôÑÎ£å');
                try {
                    // autoload=falseÎ•º ÏÇ¨Ïö©ÌñàÏúºÎØÄÎ°ú Î™ÖÏãúÏ†ÅÏúºÎ°ú load Ìò∏Ï∂ú
                    kakao.maps.load(() => {
                        console.log('‚úÖ Ïπ¥Ïπ¥Ïò§Îßµ Ï¥àÍ∏∞Ìôî ÏãúÏûë');
                        initMap();
                    });
                } catch(e) {
                    console.error('‚ùå Ïπ¥Ïπ¥Ïò§Îßµ Ï¥àÍ∏∞Ìôî Ïò§Î•ò:', e);
                    document.getElementById('shopCount').textContent = 'ÏßÄÎèÑ Î°úÎî© Ïã§Ìå®: ' + e.message;
                }
            } else if (kakaoLoadAttempts >= maxAttempts) {
                console.error('‚ùå Ïπ¥Ïπ¥Ïò§Îßµ API Î°úÎìú Ïã§Ìå® (ÌÉÄÏûÑÏïÑÏõÉ)');
                console.log('window.kakao:', window.kakao);
                document.getElementById('shopCount').textContent = 'Ïπ¥Ïπ¥Ïò§Îßµ API ÌÉÄÏûÑÏïÑÏõÉ. ÌÇ§Î•º ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.';
            } else {
                if (kakaoLoadAttempts % 10 === 0) {
                    console.log(`‚è≥ Ïπ¥Ïπ¥Ïò§Îßµ API ÎåÄÍ∏∞ Ï§ë... (${kakaoLoadAttempts}/${maxAttempts})`);
                }
                setTimeout(waitForKakao, 100);
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ïã§Ìñâ
        setTimeout(waitForKakao, 500); // 0.5Ï¥à ÌõÑ ÏãúÏûë
    </script>
</body>
</html>

